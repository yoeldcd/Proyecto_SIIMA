{% load static %}

<!--Any web pages contents is here-->
<div class="row justify-content-center">

    <script src="{% static 'js/result_list_items_listeners.js' %}"></script>
    
    <script>
        var tests = new Array();
        
        // Autogenerated: backend object_list reflection
        {% for test in object_list %}
        {% if test.state == 'notified' %}
        tests['{{ forloop.counter0 }}'] = {
            'id': "{{ test.id }}",
            'type': "{{ test.type }}",
            'patientCI': "{{ test.patientCI }}",
            'test_id': "{{ test.testID }}",
            'begin_date': "{{ test.begin_date }}",
            'resolution_date': "{{ test.resolution_date }}",
            'result': `{{ test.result }}`
        };
        {% endif %}
        {% endfor %}

    </script>
    

    <div class="col-12 text-center fs-5 fw-bold">
        Registro de Examenes
    </div>
    
    <!-- Show List filter values --->
    <div class="col-12 text-center fs-5 fw-bold">
        
        {% if filter.test_states %}
            {% if 'waiting' in filter.test_states %}
            <b class="filter-field">Pendientes</b> 
            {% elif 'resolved' in filter.test_states %}
            <b class="filter-field">Pocesados</b> 
            {% elif 'notified' in filter.test_states %}
            <b class="filter-field">Listo</b> 
            {% else %}
            <b class="filter-field">Todos</b> 
            {% endif %}
        {% endif %}
        
        {% if filter.test_type %} de tipo <b class="filter-field">{{ filter.test_type }}</b> {% endif %}
        
        {% if filter.range_first_date %} 
            desde <b class="filter-field">{{ filter.range_first_date }}</b>
            hasta <b class="filter-field">{{ filter.range_last_date }}</b> 
        {% endif %}
    
    </div>

    <!-- User analisis list-->
    <div class="col-11 col-md-10 mt-2 border border-dark overflow-auto" style="height: 50vh;">
        
        <table class="table">
            <thead>
                <th scope="col" class="col text-center">Tipo</th>
                <th scope="col" class="col text-center">Fecha</th>
                <th scope="col" class="col text-center">Estado</th>
                <th scope="col" class="col-3 text-center">Accion</th>
            </thead>
            <tbody>

                {% for test in object_list %}
                
                <tr class="examen {% if test.state == 'notified' %}bg-sucess{% endif %} fw-bold border border-dark">
                    <td class="col text-center">
                        {{test.type}}
                    </td>
                    <td class="col text-center">
                        <time>
                            {{test.begin_date}}
                        </time>
                    </td>
                    <td class="col text-center text-green">
                        {% if test.state == 'notified' %}
                        Listo
                        {% else %}
                        Procesando
                        {% endif %}
                    </td>
                    <td class="col-3 text-center">
                        
                        {% if test.state == 'notified' %}
                        
                        <!-- Test log see button-->
                        <button class="btn btn-sm btn-secondary detail-test-button" data-bs-toggle="modal"
                            data-bs-target="#resultDetailsDialog" index="{{forloop.counter0}}">
                            
                            <img src="{% static 'img/see-ligth.svg' %}" width="20" height="20"
                                class="img-fluid mb-1 me-1">
                            <span class="d-none d-sm-inline">
                                VER
                            </span>
                        </button>
                        
                        <!-- Selected Logs supress -->
                        <a href="/result/supress/{{test.id}}" class="btn btn-sm btn-danger p-1 px-3">
                            <img src="{% static 'img/delete-log.svg' %}" width="20" height="20"
                                class="img-fluid mb-1 me-1">
                            BORRAR
                        </a>

                        {% endif %}
                    </td>
                </tr>
                {% endfor %}

            </tbody>
        </table>

    </div>

    <!--User analisis actions-->
    <div class="col-11 col-md-10 mt-2 text-end">
        <button class="btn p-1 px-3 me-3 --button" data-bs-toggle="modal"
            data-bs-target="#filterListDialog">
            <img src="{% static 'img/filter.svg' %}" width="20" height="20" class="img-fluid mb-1 me-1">
            FILTRAR
        </button>
    </div>
    
    {% include 'modals/modal_detail_result.html' %}
    {% include 'modals/modal_filter_list.html' %}

</div>