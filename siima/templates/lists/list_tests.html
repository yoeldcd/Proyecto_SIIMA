{% load static %}

<!--Any web pages contents is here-->
<div class="row justify-content-center">
    
    <script>
        var tests = new Array();
        
        // Autogenerated: backend object_list reflection
        {% for test in object_list %}
        tests['{{ forloop.counter0 }}'] = {
            'id': "{{ test.id }}",
            'type': "{{ test.type }}",
            'patientCI': "{{ test.patientCI }}",
            'test_id': "{{ test.testID }}",
            'result': `{{ test.result }}`   
        };
        {% endfor %}
        
    </script>
    <script src="{% static 'js/test_list_items_listeners.js' %}"></script>
    
    <div class="col-12 text-center fs-5 fw-bold">
        Gestion de Analisis:
    </div>
    
    <!-- Show List filter values --->
    <div class="col-12 text-center fs-5 fw-bold">
        {% if filter.test_states %}
            {% if 'waiting' in filter.test_states %}
            <b class="filter-field">Pendientes</b> 
            {% elif 'resolved' in filter.test_states %}
            <b class="filter-field">Listos</b> 
            {% elif 'notified' in filter.test_states %}
            <b class="filter-field">Notificados</b> 
            {% else %}
            <b class="filter-field">Todos</b> 
            {% endif %}
        {% endif %}{% if filter.test_type %} de tipo <b class="filter-field">{{ filter.test_type }}</b> {% endif %}
        
        {% if filter.ci %} para ci <b class="filter-field">{{ filter.ci }}</b> {% endif %}
        
        {% if filter.range_first_date %} 
            desde <b class="filter-field">{{ filter.range_first_date }}</b>
            hasta <b class="filter-field">{{ filter.range_last_date }}</b> 
        {% endif %}
    </div>
    
    <!-- User analisis editable list -->
    <div class="col-11 col-md-10 mt-2 border border-dark overflow-auto" style="height: 50vh;">

        <table class="table">
            <thead>
                <th scope="col" class="col-2 text-center">Tipo</th>
                <th scope="col" class="col-2 text-center">Fecha</th>
                <th scope="col" class="col-2 text-center">Estado</th>
                <th scope="col" class="col-6 text-center">Accion</th>
            </thead>
            <tbody>

                {% for test in object_list %}

                {% if test.state == "waiting" %}
                <!-- Pending Test Entry row mode -->
                <tr class="examen bg-warning fw-bold">
                
                {% elif test.state == "notified" %}
                <!-- Pending Test Entry row mode -->
                <tr class="examen border border-dark fw-bold">
                
                {% else %}
                <!-- Executed Test Entry row mode -->
                <tr class="examen bg-green fw-bold">
                
                    {% endif %}

                    <td class="col-2">
                        {{ test.type }}
                    </td>
                    <td class="col-2">
                        <time>{{ test.begin_date }}</time>
                    </td>
                    <td class="col-2">
                        {% if test.state == "waiting" %}
                        <!-- Pending Test Entry label -->
                        PENDIENTE
                        {% elif test.state == "notified" %}
                        <!-- Pending Test Entry label -->
                        NOTIFICADO
                        {% else %}
                        <!-- Executed Test Entry label -->
                        LISTO
                        {% endif %}
                    </td>
                    <td class="col-6 text-center">
                        
                        {% if test.state != 'notified' %}

                        <!-- Test Edit button -->
                        <button class="btn btn-sm --button border-light edit-test-button col-5"
                            data-bs-toggle="modal" data-bs-target="#editTestDialog"
                            index="{{forloop.counter0}}">
                            <img src="{% static 'img/edit-profile.svg' %}" width="20" height="20"
                                class="img-fluid mb-1 me-1">
                            <span class="d-none d-lg-inline">
                                EDITAR
                            </span>
                        </button>

                        {% if test.state == "resolved" %}
                        /
                        <!-- Test Notify button -->
                        <a href="/test/notify/{{test.id}}" class="btn btn-sm btn-danger border-light col-5">
                            <img src="{% static 'img/delete-log.svg' %}" width="20" height="20"
                                class="img-fluid mb-1 me-1">
                            <span class="d-none d-lg-inline">
                                NOTIFICAR
                            </span>
                        </a>
                        {% endif %}
                        
                        {% endif %}
                        
                    </td>
                </tr>
                {% endfor %}

            </tbody>
        </table>

    </div>

    <!--User analisis actions-->
    <div class="col-11 col-md-10 mt-2 text-end">
        <button class="btn p-1 px-3 me-3 --button" data-bs-toggle="modal"
            data-bs-target="#filterListDialog">
            <img src="{% static 'img/filter.svg' %}" width="20" height="20" class="img-fluid mb-1 me-1">
            FILTRAR
        </button>
        <button class="btn btn-sm --button p-1 px-3 me-3 " data-bs-toggle="modal"
            data-bs-target="#addTestDialog">
            <img src="{% static 'img/add.svg' %}" width="20" height="20" class="img-fluid mb-1 me-1">
            NUEVO
        </button>
    </div>
    
    <!-- Include togleables modal dialogs -->
    {% include 'modals/modal_add_test.html' %}
    {% include 'modals/modal_edit_test.html' %}
    {% include 'modals/modal_filter_list.html' %}

</div>